!function(){!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.crel=b()}(this,function(){function a(){var d,l=arguments,m=l[0],p=l[1],q=2,r=l.length,s=a[g];if(m=a[i](m)?m:j.createElement(m),1===r)return m;if((!k(p,c)||a[h](p)||n(p))&&(--q,p=null),r-q===1&&k(l[q],"string")&&void 0!==m[e])m[e]=l[q];else for(;r>q;++q)if(d=l[q],null!=d)if(n(d))for(var t=0;t<d.length;++t)o(m,d[t]);else o(m,d);for(var u in p)if(s[u]){var v=s[u];typeof v===b?v(m,p[u]):m[f](v,p[u])}else m[f](u,p[u]);return m}var b="function",c="object",d="nodeType",e="textContent",f="setAttribute",g="attrMap",h="isNode",i="isElement",j=typeof document===c?document:{},k=function(a,b){return typeof a===b},l=typeof Node===b?function(a){return a instanceof Node}:function(a){return a&&k(a,c)&&d in a&&k(a.ownerDocument,c)},m=function(b){return a[h](b)&&1===b[d]},n=function(a){return a instanceof Array},o=function(b,c){a[h](c)||(c=j.createTextNode(c)),b.appendChild(c)};return a[g]={},a[i]=m,a[h]=l,"undefined"!=typeof Proxy&&(a.proxy=new Proxy(a,{get:function(b,c){return!(c in a)&&(a[c]=a.bind(null,c)),a[c]}})),a});var src,dst,buffer,wrapper=crel("div",{id:"wrapper"}),stage=crel("canvas",{id:"stage",width:"512",height:"512"}),control=crel("div",{id:"control"}),image=crel("canvas",{width:512,height:512});crel(document.body,crel(wrapper,stage,control)),window.receiveJavaScript=function(a,b){console.log("window.receiveJavaScript",a,b)};var img=new Image;img.src="../../assets/lena.jpg",img.onload=function(){image.getContext("2d").drawImage(img,0,0),setTimeout(function(){window.indicator.stop();wrapper.style.opacity=1,src=new Uint8Array(Module.HEAPU8.buffer,Module._malloc(img.width*img.height<<2),img.width*img.height<<2),src.set(new Uint8Array(image.getContext("2d").getImageData(0,0,img.width,img.height).data.buffer)),dst=new Uint8Array(Module.HEAPU8.buffer,Module._malloc(img.width*img.height<<2),img.width*img.height<<2),buffer=Module._malloc(1024),Module.writeStringToMemory(JSON.stringify({y:0,x:0,brightness:!0}),buffer),Module.cwrap("setup","void",["number"])(buffer),Module.cwrap("data","void",["number"])(src.byteOffset),Module.cwrap("processimage","void",["number"])(dst.byteOffset);var a=stage.getContext("2d").getImageData(0,0,img.width,img.height);a.data.set(dst),stage.getContext("2d").putImageData(a,0,0)},50)};var _target=null;window.gui=window.gui||{callback:void 0},window.gui.isTouch="ontouchstart"in window;var mouseup=function(a){a.preventDefault(),window.gui.callback=void 0},mousemove=function(a){a.preventDefault(),window.gui.callback&&(window.gui.isTouch&&(a=a.touches[0]),window.gui.callback(window.gui.clientX+(a.screenX-window.gui.screenX)))};window.gui.isTouch?(window.addEventListener("touchend",mouseup,!1),window.addEventListener("touchcancel",mouseup,!1),window.addEventListener("touchmove",mousemove,!1)):(window.addEventListener("mouseup",mouseup,!1),window.addEventListener("mousemove",mousemove,!1));var css=function(a,b){for(o in b)void 0!==a.style[o]&&(a.style[o]=b[o]);return a},createSlider=function(a){return function(a){var b=a.width||document.documentElement.offsetWidth,c=css(crel("div"),{position:"relative",marginTop:"16px",height:"80px",display:"inline-block",verticalAlign:"bottom",cursor:"pointer",webkitTapHighlightColor:"rgba(0,0,0,0)",width:b+20+"px"}),d=css(crel("div"),{position:"absolute",pointerEvents:"none",top:"36px",width:b+20+"px",height:"8px",backgroundColor:"#4e4e4e",borderRadius:"4px",zIndex:0}),e=css(crel("div"),{position:"absolute",pointerEvents:"none",top:"36px",left:"10px",width:b+10+"px",height:"8px",backgroundColor:"#b3b3b3",borderRadius:"4px",zIndex:1}),f=css(crel("div"),{position:"absolute",pointerEvents:"none",left:"10px",width:"10px",height:"80px",backgroundColor:"#f81502",borderRadius:"2px",zIndex:2}),g=a.range[0]||0,h=a.range[1]||255,i=0;return c.addEventListener(window.gui.isTouch?"touchstart":"mousedown",function(c){c.preventDefault(),window.gui.isTouch&&(c=c.touches[0]),window.gui.callback=function(c){c-=this.getBoundingClientRect().left,c<10&&(c=10),c>b+10&&(c=b+10),i=(c-10)/b,Module.writeStringToMemory(a.key,buffer),Module.cwrap("set","void",["number"])(buffer,g+i*(h-g)),Module.cwrap("processimage","void",["number"])(dst.byteOffset);var d=stage.getContext("2d").getImageData(0,0,img.width,img.height);d.data.set(dst),stage.getContext("2d").putImageData(d,0,0),css(e,{left:c+"px"}),css(e,{width:b+20-c+"px"}),css(f,{left:c-5+"px"})}.bind(this),window.gui.clientX=c.clientX,window.gui.screenX=c.screenX,window.gui.callback(window.gui.clientX)},!1),(a.parent||document.body).appendChild(c),c.appendChild(d),c.appendChild(e),c.appendChild(f),{el:c}}(a)},slider=[];slider.push(createSlider({parent:control,width:100,key:"y",range:[0,255],style:{float:"left"}})),slider.push(createSlider({parent:control,width:100,key:"x",range:[0,255],style:{float:"left"}})),slider[0].el.style.marginRight="30px";var timer=0,onResize=function(a){timer&&(clearTimeout(timer),timer=0),timer=setTimeout(function(){if(window.innerWidth<512){stage.style.height=stage.style.width=document.documentElement.offsetWidth+"px";var a=270;slider[0].el.style.marginLeft=(document.documentElement.offsetWidth-a>>1)+"px";document.documentElement.offsetWidth;control.style.marginLeft=stage.style.marginLeft=0}else{stage.style.height=stage.style.width="512px";var a=256;slider[0].el.style.marginLeft=(512-a>>1)+"px",control.style.marginLeft=stage.style.marginLeft=(document.documentElement.offsetWidth-512>>1)+"px"}var c=stage.offsetHeight+80;if(window.innerHeight-32-32>c+32)wrapper.style.marginTop=(window.innerHeight-32-c>>1)+"px",document.body.style.overflowY="hidden",control.style.marginTop="32px";else if(window.innerHeight-32>c)wrapper.style.marginTop=0,document.body.style.overflowY="auto",control.style.marginTop=(window.innerHeight-c>>1)+"px";else{wrapper.style.marginTop=0,document.body.style.overflowY="auto";var d=document.getElementById("slider");d.style.marginTop="32px"}timer=0},50)};window.addEventListener("resize",onResize),onResize();}();